<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Photo Booth Live Frame dengan Timer & Suara</title>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

<style>
/* ===== BODY & LAYOUT PREMIUM ===== */
body {
  font-family: 'Montserrat', sans-serif;
  background: linear-gradient(145deg, #0f2027, #203a43, #2c5364);
  margin: 0;
  padding: 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
  color: #f0f0f0;
}

/* HEADER */
h1 {
  text-align: center;
  width: 100%;
  margin: 0 auto;
  font-size: 2.8em;
  margin-bottom: 20px;
  color: #ffffff;
  text-shadow: 0 0 20px #ff4d6d, 0 0 40px #ff4d6d66;
}

/* ===== SIDEBAR STYLING ===== */
#sidebar {
  position: fixed;
  left: 0;
  top: 0;
  width: 250px;
  height: 100%;
  background: linear-gradient(145deg, #1e3c72, #2a5298);
  color: white;
  display: flex;
  flex-direction: column;
  z-index: 1000;
  box-shadow: 2px 0 10px rgba(0,0,0,0.5);
  transition: transform 0.3s ease;
}

#sidebar ul {
  list-style: none;
  padding: 0;
  margin: 0;
  margin-top: 80px;
}

#sidebar li {
  padding: 15px 20px;
  cursor: pointer;
  border-bottom: 1px solid rgba(255,255,255,0.1);
  transition: all 0.3s ease;
  font-weight: 500;
}

#sidebar li:hover {
  background: rgba(255,255,255,0.1);
  padding-left: 25px;
}

#sidebar li:active {
  background: rgba(255,255,255,0.2);
}

/* ‚úÖ PERBAIKAN SIDEBAR STATES */
.sidebar-closed {
    transform: translateX(-100%) !important;
}

.sidebar-open {
    transform: translateX(0) !important;
}

/* ‚úÖ HAMBURGER MENU STYLING YANG BENAR */
#hamburger-menu {
    position: fixed !important;
    top: 15px !important;
    left: 15px !important;
    font-size: 14px !important;
    cursor: pointer !important;
    z-index: 1001 !important;
    background: rgba(30, 60, 114, 0.9) !important;
    color: white !important;
    padding: 10px 15px !important;
    border-radius: 5px !important;
    transition: all 0.3s ease !important;
    display: none; /* Default hidden, akan dikontrol JS */
    border: 2px solid rgba(255,255,255,0.3) !important;
}

#hamburger-menu:hover {
    background: rgba(30, 60, 114, 1) !important;
    transform: scale(1.1) !important;
    box-shadow: 0 0 15px rgba(0,255,255,0.5) !important;
}

/* Konten Utama */
#mainContent {
  margin-left: 260px; /* Sesuaikan dengan lebar sidebar */
  padding: 20px;
  width: calc(100% - 260px);
  transition: margin-left 0.3s ease;
}

/* ‚úÖ Ketika sidebar tertutup, adjust main content */
body.sidebar-closed #mainContent {
    margin-left: 0 !important;
    width: 100% !important;
}

/* Style untuk content sections */
.contentSection {
  background: rgba(255,255,255,0.1);
  padding: 20px;
  border-radius: 10px;
  margin-top: 20px;
  min-height: 400px;
}

.contentSection h2 {
  color: #00ffff;
  margin-bottom: 15px;
}

/* CAMERA CONTAINER */
#camera-container {
  position: relative;
  display: none;
  border-radius: 30px;
  overflow: hidden;
  box-shadow: 0 20px 50px rgba(0,0,0,0.7);
  background: #111;
  border: 2px solid rgba(255,255,255,0.1);
  width: 100%;
  max-width: 540px;
  margin: auto;
}

/* VIDEO & FRAME */
video, canvas, #frame-overlay {
  width: 100%;
  height: auto;
  aspect-ratio: 4 / 3;
  border-radius: 30px;
  object-fit: cover;
  box-shadow: inset 0 0 25px rgba(255,255,255,0.08);
  transform: scaleX(-1);
}

/* FRAME OVERLAY */
#frame-overlay {
  position: absolute;
  top: 0;
  left: 0;
  pointer-events: none;
  display: none;
  border-radius: 30px;
  box-shadow: 0 0 25px rgba(255,255,255,0.2);
  transform: scaleX(-1);
  z-index: 2;
}

/* COUNTDOWN NEON */
#countdown {
  position: absolute;
  top: 42%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 95px;
  font-weight: 900;
  color: #00ffff;
  text-shadow: 0 0 10px #00ffff, 0 0 25px rgba(0,255,255,0.5);
  display: none;
}

/* VIDEO TIMER */
#videoTimer {
  position: absolute;
  top: 15px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 28px;
  font-weight: 700;
  color: #00ffea;
  background: rgba(0,0,0,0.55);
  padding: 8px 20px;
  border-radius: 20px;
  display: none;
  box-shadow: 0 8px 25px rgba(0,255,255,0.25);
  text-shadow: 0 0 5px #00fff0;
}

/* ===== BUTTONS PREMIUM ICON STYLE ===== */
button, select {
  margin: 8px;
  padding: 14px 24px;
  border-radius: 20px;
  border: none;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
  backdrop-filter: blur(12px);
}

button {
  background: linear-gradient(145deg, #ff416c, #ff4b2b);
  color: #fff;
  font-size: 16px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.45);
  position: relative;
}

button::after {
  content: '';
  position: absolute;
  top:0; left:0;
  width: 100%; height: 100%;
  border-radius: 20px;
  box-shadow: 0 0 15px rgba(255,255,255,0.25);
  pointer-events: none;
}

button:hover {
  transform: translateY(-3px) scale(1.03);
  box-shadow: 0 12px 28px rgba(0,0,0,0.55), 0 0 12px rgba(255,255,255,0.3);
}

button:active {
  transform: translateY(1px) scale(0.99);
  box-shadow: 0 6px 18px rgba(0,0,0,0.55);
}

/* SELECT */
select {
  background: rgba(255,255,255,0.12);
  color: #fff;
  font-size: 15px;
  padding: 10px 16px;
  backdrop-filter: blur(8px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.4);
}

/* ===== GALLERY THUMB ===== */
#gallery {
  margin-top: 30px;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 16px;
}

.thumb {
  width: 100px;
  height: 75px;
  object-fit: cover;
  border-radius: 18px;
  cursor: pointer;
  box-shadow: 0 10px 28px rgba(0,0,0,0.45);
  transition: all 0.35s ease;
}

.thumb:hover {
  transform: scale(1.15) rotate(-1.5deg);
  box-shadow: 0 14px 38px rgba(0,0,0,0.6);
}

/* ===== MODAL PREVIEW ===== */
#previewModal {
  display: none;
  position: fixed;
  top: 0; left:0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.95);
  justify-content: center;
  align-items: center;
}

#previewWrapper {
  position: relative;
  display: flex;
  align-items: center;
  gap: 35px;
}

#previewModal img {
  max-width: 80%;
  max-height: 80%;
  border-radius: 25px;
  box-shadow: 0 0 45px rgba(0,255,255,0.5);
}

/* NAV BUTTONS */
.nav-btn {
  background: rgba(0,255,255,0.2);
  border: none;
  border-radius: 50%;
  font-size: 32px;
  font-weight: bold;
  cursor: pointer;
  padding: 16px 20px;
  transition: all 0.35s ease;
  color: #00ffff;
  text-shadow: 0 0 10px #00ffff;
}

.nav-btn:hover {
  background: rgba(0,255,255,0.5);
  transform: scale(1.2);
}

/* VIDEO CONTROLS */
#videoControls {
  display: none;
  position: absolute;
  bottom: 18px;
  left: 50%;
  transform: translateX(-50%);
  gap: 14px;
  z-index: 10;
}

/* ANIMASI SHRINK FADE */
@keyframes floatShrinkHold {
  0% { transform: scale(1) translateY(0); opacity: 1; }
  30% { transform: scale(1) translateY(0); opacity: 1; }
  100% { transform: scale(0.5) translateY(50px); opacity: 0; }
}

.float-shrink-hold {
  animation: floatShrinkHold 2s forwards;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

/* ===== Perbaikan dropdown select ===== */
select {
  color: #fff;
  background-color: rgba(0,0,0,0.4);
  border: 1px solid rgba(255,255,255,0.3);
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  position: relative;
  padding-right: 30px;
  background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12'%3E%3Cpolygon points='0,0 12,0 6,6' fill='%23fff'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 10px center;
  background-size: 12px;
}

select option {
  color: #000;
  background-color: #fff;
}

select option:hover {
  background-color: #00ffff33;
  color: #000;
}

  video, canvas, #frame-overlay {
    width: 100%;
    height: auto;
  }

  #videoControls {
    bottom: 10px;
  }

  #sidebar {
    width: 200px;
  }
  
  #mainContent {
    margin-left: 210px;
    width: calc(100% - 210px);
  }
  
  body.sidebar-closed #mainContent {
    margin-left: 0 !important;
    width: 100% !important;
  }


/* Pastikan frame mengikuti ukuran video/canvas */
#frameOverlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  pointer-events: none;
}

/* ‚úÖ STYLE UNTUK MENU HOME FEEDBACK */
#menuHome {
  transition: all 0.2s ease;
  position: relative;
}

#menuHome:active {
  background: rgba(255,255,255,0.3) !important;
  transform: scale(0.95);
}

/* Animasi untuk double click feedback */
@keyframes homePulse {
  0% { background: rgba(255,255,255,0.1); }
  50% { background: rgba(0,255,255,0.3); }
  100% { background: rgba(255,255,255,0.1); }
}

.home-double-click {
  animation: homePulse 0.6s ease;
}

.custom-swal-popup {
    border-radius: 12px !important;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.6) !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
}

.custom-swal-title {
    color: #ffd700 !important; /* ‚úÖ GOLD UNTUK KONTRA DENGAN HIJAU */
    font-size: 1.3rem !important;
    font-weight: bold !important;
    text-shadow: 0 0 8px rgba(255, 215, 0, 0.7) !important;
    margin-bottom: 0.8rem !important;
}

.custom-swal-text {
    color: #ffffff !important;
    font-size: 0.95rem !important;
    line-height: 1.4 !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3) !important;
}

.swal2-confirm {
    background: linear-gradient(145deg, #ff416c, #ff4b2b) !important;
    border: none !important;
    border-radius: 18px !important;
    padding: 8px 20px !important;
    font-weight: bold !important;
    font-size: 0.9rem !important;
    box-shadow: 0 4px 15px rgba(255, 65, 108, 0.3) !important;
}

.swal2-cancel {
    background: linear-gradient(145deg, #6c757d, #5a6268) !important;
    border: none !important;
    border-radius: 18px !important;
    padding: 8px 20px !important;
    font-weight: bold !important;
    font-size: 0.9rem !important;
}

/* ===== ‚úÖ RESPONSIVE SCALING (TAMPILAN SAMA TAPI LEBIH KECIL) ===== */
@media (max-width: 768px) {
    #main-container {
        transform: scale(0.8);
        transform-origin: top center;
        margin: -30px auto;
        width: 100%;
    }
    
    /* Pastikan tombol tetap bisa diklik */
    button, select {
        min-height: 44px;
    }
}

@media (max-width: 480px) {
    #main-container {
        transform: scale(0.7);
        margin: -50px auto;
    }
}

@media (max-width: 360px) {
    #main-container {
        transform: scale(0.6);
        margin: -60px auto;
    }
}

</style>
</head>
<body>

<!-- ===== ‚úÖ HARUS DI BAWAH INI: HAMBURGER & SIDEBAR ===== -->
<div id="hamburger-menu" style="display:none;">‚ò∞</div>
<!-- Sidebar Vertikal -->
<div id="sidebar">
  <ul>
    <li id="menuHome">üè†Home</li>
    <li id="menuGuide">üìñ Petunjuk Penggunaan</li>
    <li id="menuAbout">‚Ñπ Tentang Kami</li>
  </ul>
</div>

<!-- ===== DASHBOARD UTAMA ===== -->
<div id="dashboard" style="text-align:center; margin-top:80px;">
  <h1>Selamat Datang di Web Photo Booth</h1>
  
  <!-- ‚úÖ STATUS PEMBAYARAN LEBIH DETAIL -->
  <div id="statusPembayaran" style="margin:20px auto; padding:15px; border-radius:10px; 
              max-width:500px; display:none;">
    <!-- Status akan diisi oleh JavaScript -->
  </div>
  
  <p>Pilih menu di bawah ini untuk melanjutkan:</p>
  <button onclick="showSection('paket')">üì¶ Menu Paket</button>
  <button onclick="showSection('pembayaran')">üí≥ Menu Pembayaran</button>
  <button onclick="showSection('photobooth')">üé• Masuk ke Photo Booth</button>
</div>

<div id="photobooth-section" style="display:none;">
  <h1>üì∏ Photo Booth</h1>

<!-- MAIN CONTAINER 3 KOLOM -->
<div id="main-container" style="display:flex; gap:30px; justify-content:center; align-items:flex-start;">

  <!-- KOLOM KIRI: tombol utama -->
  <div id="left-panel" style="display:flex; flex-direction:column; gap:3px; margin-top:70px;">
    <button id="startBtn">Nyalakan Kamera</button>
    <button id="captureBtn">Ambil Foto</button>
    <button id="videoBtn">Video</button>
    <button id="deleteBtn">Hapus Foto/Video</button>
    <button id="stopBtn">Matikan Kamera</button>
  </div>

  <!-- KOLOM TENGAH: kamera & video -->
  <div id="center-panel" style="position:relative;">
    <div id="paketTimerDisplay" 
     style="font-size: 24px; font-weight: bold; color: #00ffea; 
            background: rgba(0,0,0,0.5); padding: 8px 18px; 
            border-radius: 18px; text-align:center; display:none;
            margin-bottom: 22px;">
</div>
    <div id="camera-container">
      <video id="video" autoplay></video>
      <canvas id="canvas" style="display:none;"></canvas>
      <img id="frame-overlay" src="" alt="Frame Overlay">
      <div id="countdown"></div>
      <div id="videoTimer"></div>
      <div id="videoControls">
        <button id="startRecBtn">‚è∫</button>
        <button id="pauseRecBtn" style="display:none;">‚è∏</button>
        <button id="resumeRecBtn" style="display:none;">‚èØ</button>
        <button id="stopRecBtn" style="display:none;">‚èπ</button>
      </div>
    </div>
  </div>

  <!-- KOLOM KANAN: timer, filter, frame -->
  <div id="right-panel" style="display:flex; flex-direction:column; gap:22px; margin-top:80px;">
    <label for="timerSelect">Timer:</label>
    <select id="timerSelect">
      <option value="0">Tanpa Timer</option>
      <option value="3">3 Detik</option>
      <option value="5">5 Detik</option>
      <option value="10">10 Detik</option>
    </select>

    <label for="filterSelect">Filter:</label>
    <select id="filterSelect">
      <option value="none">Normal</option>
      <option value="grayscale(1)">Grayscale</option>
      <option value="sepia(1)">Sepia</option>
      <option value="contrast(1.5)">Kontras Tinggi</option>
      <option value="brightness(1.3)">Lebih Cerah</option>
      <option value="blur(2px)">Blur</option>
    </select>

    <label for="frameSelect">Frame:</label>
    <select id="frameSelect">
      <option value="">Tanpa Frame</option>
      <option value="frame1.png">Frame 1</option>
      <option value="frame2.png">Frame 2</option>
      <option value="frame3.png">Frame 3</option>
      <option value="frame4.png">Frame 4</option>
    </select>
  </div>
</div>

<h3 style="text-align:center; margin-top:80px;">Hasil Foto/Video</h3>
<div id="gallery"></div>

 <!-- ‚úÖ TOMBOL BARU: Download & Cetak -->
    <div style="margin-top:20px; border-top:1px solid rgba(255,255,255,0.2); padding-top:20px;">
        <button id="downloadBtn" style="width:100%; background:linear-gradient(145deg, #0072ff, #00c6ff);">
            üì• Download Hasil
        </button>
        <button id="printBtn" style="width:100%; background:linear-gradient(145deg, #ff8c00, #ff2d00); margin-top:10px;">
            üñ® Cetak Foto
        </button>
    </div>
</div>

<div id="previewModal" onclick="this.style.display='none'">
  <div id="previewWrapper" onclick="event.stopPropagation()">
    <button id="prevBtn" class="nav-btn" onclick="showPrev(event)">&lt;</button>
    <img id="previewImage" src="">
    <button id="nextBtn" class="nav-btn" onclick="showNext(event)">&gt;</button>
  </div>
</div>

<section id="pembayaran-section" style="display:none; text-align:center; margin-top:30px;">
  <h2>üí≥ Menu Pembayaran</h2>
  <p>Isi data dan pilih metode pembayaran Anda.</p>

  <form id="formPembayaran" style="max-width:400px; margin:auto;">
    <label>Nama:</label><br>
    <input type="text" id="nama" placeholder="Nama penyewa" required><br><br>

    <label>Email:</label><br>
    <input type="email" id="email" placeholder="Email penyewa" required><br><br>

    <label>No. HP:</label><br>
    <input type="tel" id="nohp" placeholder="08xxxxxxxxxx" required><br><br>

    <label>Metode Pembayaran:</label><br>
    <select id="metode">
      <option value="">-- Pilih Metode --</option>
      <option value="transfer">Transfer Bank</option>
      <option value="qris">QRIS</option>
      <option value="ewallet">E-Wallet (Dana, OVO, Gopay)</option>
    </select><br><br>

    <button type="button" onclick="kirimPembayaran()">Kirim Pembayaran</button>
  </form>

  <div id="hasilPembayaran" style="margin-top:20px; display:none;"></div>
</section>

<!-- ===== MENU PAKET ===== -->
<section id="paket-section" style="display:none; text-align:center; margin-top:30px;">
  <h2>üì¶ Pilihan Paket Photo Booth</h2>
  <p>Pilih paket sesuai kebutuhan acara Anda.</p>

  <div style="display:flex; justify-content:center; flex-wrap:wrap; gap:20px; margin-top:30px;">

    <!-- Paket Basic -->
    <div style="background:#222; color:white; padding:20px; border-radius:10px; width:250px;">
      <h3>üì∏ Paket Basic</h3>
      <p>Durasi: 1 jam</p>
      <p>10 Foto + 2 Video</p>
      <p>Harga: Rp 150.000</p>
      <button onclick="pilihPaket('Basic')">Pilih Paket Ini</button>
    </div>

    <!-- Paket Premium -->
    <div style="background:#333; color:white; padding:20px; border-radius:10px; width:250px;">
      <h3>üåü Paket Premium</h3>
      <p>Durasi: 2 jam</p>
      <p>20 Foto + 5 Video</p>
      <p>Harga: Rp 250.000</p>
      <button onclick="pilihPaket('Premium')">Pilih Paket Ini</button>
    </div>

    <!-- Paket VIP -->
    <div style="background:#444; color:white; padding:20px; border-radius:10px; width:250px;">
      <h3>üëë Paket VIP</h3>
      <p>Durasi: 3 jam</p>
      <p>Unlimited Foto + 10 Video</p>
      <p>Harga: Rp 400.000</p>
      <button onclick="pilihPaket('VIP')">Pilih Paket Ini</button>
    </div>
  </div>
</section>

<script>

// Override dengan styling tema neon Anda
window.alert = (msg) => Swal.fire({
    title: '‚Ñπ Info',
    text: msg,
    icon: 'info',
    confirmButtonText: 'OK',
    background: 'linear-gradient(145deg, #2d6a4f, #40916c)', // ‚úÖ HIJAU TERANG
    color: '#ffffff',
    confirmButtonColor: '#ff416c',
    width: '300px',
    padding: '1.2rem',
    backdrop: 'rgba(0, 0, 0, 0.5)',
    customClass: {
        popup: 'custom-swal-popup',
        title: 'custom-swal-title',
        htmlContainer: 'custom-swal-text'
    }
});

window.confirm = (msg) => Swal.fire({
    title: '‚ùì Konfirmasi', 
    text: msg, 
    icon: 'question', 
    showCancelButton: true,
    confirmButtonText: 'Ya',
    cancelButtonText: 'Tidak',
    background: 'linear-gradient(145deg, #2d6a4f, #40916c)', // ‚úÖ HIJAU TERANG
    color: '#ffffff',
    confirmButtonColor: '#ff416c',
    cancelButtonColor: '#6c757d',
    width: '80px',
    padding: '1.2rem',
    backdrop: 'rgba(0, 0, 0, 0.5)',
    customClass: {
        popup: 'custom-swal-popup',
        title: 'custom-swal-title', 
        htmlContainer: 'custom-swal-text'
    }
}).then(result => result.isConfirmed);

// Fungsi untuk menampilkan section tertentu
function showSection(sectionId) {
    console.log("üîÑ Menampilkan section:", sectionId);
    
    // Sembunyikan semua section utama
    const sectionsToHide = ["dashboard", "photobooth-section", "pembayaran-section", "paket-section"];
    sectionsToHide.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
            element.style.display = "none";
            console.log("‚ùå Sembunyikan:", id);
        }
    });
    
    // Sembunyikan semua content section sidebar
    const sections = document.querySelectorAll(".contentSection");
    sections.forEach(sec => {
        sec.style.display = "none";
        console.log("‚ùå Sembunyikan sidebar section:", sec.id);
    });
    
    // Tampilkan section yang dipilih
    if (sectionId === "dashboard") {
        document.getElementById("dashboard").style.display = "block";
        console.log("‚úÖ Tampilkan: dashboard");
    } else if (sectionId === "photobooth") {
        if (!paketActive) {
            alert("Silakan pilih paket terlebih dahulu.");
            document.getElementById("dashboard").style.display = "block";
            return;
        }
        document.getElementById("photobooth-section").style.display = "block";
        console.log("‚úÖ Tampilkan: photobooth-section");
        mulaiTimerPaket();
    } else if (sectionId === "pembayaran") {
        document.getElementById("pembayaran-section").style.display = "block";
        console.log("‚úÖ Tampilkan: pembayaran-section");
    } else if (sectionId === "paket") {
        document.getElementById("paket-section").style.display = "block";
        console.log("‚úÖ Tampilkan: paket-section");
    } else {
        // Untuk section sidebar (filesContent, guideContent, aboutContent)
        const targetSection = document.getElementById(sectionId);
        if (targetSection) {
            targetSection.style.display = "block";
            console.log("‚úÖ Tampilkan sidebar section:", sectionId);
            console.log("üìç Posisi:", targetSection.getBoundingClientRect());
            console.log("üé® Style display:", window.getComputedStyle(targetSection).display);
            
            // Force redraw dan beri border debug
            targetSection.style.border = "3px solid #00ff00";
            targetSection.style.background = "rgba(0,255,0,0.1)";
        } else {
            console.error("‚ùå Section tidak ditemukan:", sectionId);
        }
    }
}

// ===== VARIABLES & FUNGSI CAMERA =====
const video = document.getElementById('video');  
const canvas = document.getElementById('canvas');  
const frameOverlay = document.getElementById('frame-overlay');  
const countdownEl = document.getElementById('countdown');  
const startBtn = document.getElementById('startBtn');  
const stopBtn = document.getElementById('stopBtn');  
const captureBtn = document.getElementById('captureBtn');  
const deleteBtn = document.getElementById('deleteBtn');  
const timerSelect = document.getElementById('timerSelect');  
const filterSelect = document.getElementById('filterSelect');  
const gallery = document.getElementById('gallery');  
const videoBtn = document.getElementById('videoBtn');  
const videoControlsContainer = document.getElementById('videoControls');  
const startRecBtn = document.getElementById('startRecBtn');  
const stopRecBtn = document.getElementById('stopRecBtn');  
const pauseRecBtn = document.getElementById('pauseRecBtn');  
const prevBtn = document.getElementById('prevBtn');  
const nextBtn = document.getElementById('nextBtn');  
const videoTimerEl = document.getElementById('videoTimer');  
const frameSelect = document.getElementById('frameSelect');
const downloadBtn = document.getElementById('downloadBtn');
const printBtn = document.getElementById('printBtn');
const menuHome = document.getElementById('menuHome');

let lastCapturedData = null;
let fotoSiap = false;
let paketActive = false;
let paketDuration = 0;
let paketTimer = null;
let waktuSisa = 0;
let stream = null;  
let currentFrame = "";  
let audioEnabled = false;  
let galleryImages = [];  
let currentIndex = 0;  
let showingPhoto = false;  
let isPreviewActive = false; 
let mediaRecorder = null;  
let recordedChunks = [];  
let videoTimerInterval = null;  
let videoStartTime = null;
let homeClickTimer = null; 
let sidebar = null;
let hamburgerMenu = null;
let isSidebarOpen = true;
let pembayaranVerified = false; 

// ‚úÖ INISIALISASI SIDEBAR
function initSidebar() {
    sidebar = document.getElementById('sidebar');
    hamburgerMenu = document.getElementById('hamburger-menu');
    
    if (sidebar && hamburgerMenu) {
        console.log("‚úÖ Sidebar dan hamburger menu berhasil diinisialisasi");
        updateSidebarState();
        hamburgerMenu.addEventListener('click', toggleSidebar);
        document.addEventListener('click', closeSidebarOnClickOutside);
    } else {
        console.error("‚ùå Element sidebar atau hamburger menu tidak ditemukan");
    }
}

// ‚úÖ TOGGLE SIDEBAR
function toggleSidebar(event) {
    if (event) event.stopPropagation();
    
    if (isSidebarOpen) {
        closeSidebar();
    } else {
        openSidebar();
    }
}

// ‚úÖ BUKA SIDEBAR
function openSidebar() {
    if (sidebar) {
        sidebar.classList.remove('sidebar-closed');
        sidebar.classList.add('sidebar-open');
        isSidebarOpen = true;
        console.log("üîì Sidebar dibuka");
    }
}

// ‚úÖ TUTUP SIDEBAR
function closeSidebar() {
    if (sidebar) {
        sidebar.classList.remove('sidebar-open');
        sidebar.classList.add('sidebar-closed');
        isSidebarOpen = false;
        console.log("üîí Sidebar ditutup");
    }
}

// ‚úÖ TUTUP SIDEBAR KETIKA KLIK DI LUAR
function closeSidebarOnClickOutside(event) {
    if (!isSidebarOpen) return;
    
    const isClickInsideSidebar = sidebar.contains(event.target);
    const isClickOnHamburger = hamburgerMenu.contains(event.target);
    
    if (!isClickInsideSidebar && !isClickOnHamburger) {
        closeSidebar();
    }
}

// ‚úÖ UPDATE STATE SIDEBAR BERDASARKAN HALAMAN
function updateSidebarState() {
    const currentSection = getCurrentSection();
    console.log("üìç Current section:", currentSection);
    
    if (currentSection === 'dashboard') {
        // üè† HALAMAN UTAMA: Sidebar terbuka, hamburger TAMPIL
        openSidebar();
        if (hamburgerMenu) {
            hamburgerMenu.style.display = 'block';
            console.log("üè† Halaman utama - Sidebar terbuka, hamburger tampil");
        }
    } else {
        // üì± HALAMAN LAIN: Sidebar tertutup, hamburger TAMPIL
        closeSidebar();
        if (hamburgerMenu) {
            hamburgerMenu.style.display = 'block';
            console.log("üì± Halaman lain - Sidebar tertutup, hamburger tampil");
        }
    }
}

// ‚úÖ DETEKSI HALAMAN AKTIF
function getCurrentSection() {
    if (document.getElementById('dashboard').style.display !== 'none') return 'dashboard';
    if (document.getElementById('photobooth-section').style.display !== 'none') return 'photobooth';
    if (document.getElementById('pembayaran-section').style.display !== 'none') return 'pembayaran';
    if (document.getElementById('paket-section').style.display !== 'none') return 'paket';
    return 'dashboard';
}

frameSelect.addEventListener('change', () => {
  const selectedFrame = frameSelect.value;
  if (!selectedFrame) {
    frameOverlay.style.display = 'none';
    currentFrame = "";
  } else {
    currentFrame = selectedFrame;
    frameOverlay.src = selectedFrame;
    frameOverlay.style.display = 'block';
  }
});  
// Mulai timer video  
// Mulai timer video
function startVideoTimer() {  
  videoTimerEl.style.display = 'block';  
  videoStartTime = Date.now();  
  videoTimerInterval = setInterval(updateVideoTimer, 500);  
}

// Hentikan timer video
function stopVideoTimer() {  
  clearInterval(videoTimerInterval);  
  videoTimerEl.style.display = 'none';  
}

// Jeda timer video
function pauseVideoTimer() {  
  if (videoTimerInterval) clearInterval(videoTimerInterval);  
  if (videoStartTime) {
    videoPausedTime = Date.now() - videoStartTime; // simpan durasi saat pause
  }
}

// Lanjutkan timer video setelah pause
function resumeVideoTimer() {  
  if (videoPausedTime == null) return;  
  videoStartTime = Date.now() - videoPausedTime; // hitung offset
  videoTimerInterval = setInterval(updateVideoTimer, 500);
}

// Fungsi pembaruan tampilan timer
function updateVideoTimer() {
  const diff = Math.floor((Date.now() - videoStartTime) / 1000);  
  const h = Math.floor(diff / 3600).toString().padStart(2,'0');  
  const m = Math.floor((diff % 3600 / 60)).toString().padStart(2,'0');  
  const s = (diff % 60).toString().padStart(2,'0');  
  videoTimerEl.textContent = `${h}:${m}:${s}`;
}

  
function addToGallery(item) {
  const index = galleryImages.length;
  galleryImages.push({ data: item, type: 'photo', frame: currentFrame }); // simpan frame saat foto diambil

  const thumb = document.createElement('img');
  thumb.className = "thumb";
  thumb.src = item;

  // ketika diklik, tampilkan langsung di canvas di atas video
  thumb.onclick = () => {
    currentIndex = index;
    showingPhoto = true;
    showOnCamera(index); // tampilkan dengan frame yang tersimpan
  };

  gallery.appendChild(thumb);
}
 
// Fungsi khusus untuk video  
function addVideoToGallery(videoURL) {
  const index = galleryImages.length;
  galleryImages.push({ data: videoURL, type: 'video', frame: currentFrame }); // simpan frame saat video

  const vid = document.createElement('video');
  vid.src = videoURL;
  vid.className = "thumb";
  vid.muted = true;
  vid.loop = true;
  vid.autoplay = true;

  vid.onclick = () => {
    currentIndex = index;
    showVideoOnCamera(videoURL, true, galleryImages[index].frame); // kirim frame yang tersimpan
  };

  gallery.appendChild(vid);
}
// üîä Bunyi timer  
function playBeep() {  
  if (!audioEnabled) return;  
  const ctx = new AudioContext();  
  const osc = ctx.createOscillator();  
  osc.type = "square";  
  osc.frequency.value = 800;  
  const gain = ctx.createGain();  
  gain.gain.value = 0.1;  
  osc.connect(gain);  
  gain.connect(ctx.destination);  
  osc.start();  
  osc.stop(ctx.currentTime + 0.1);  
}  
  
// üîä Suara jepret  
function playShutter() {  
  if (!audioEnabled) return;  
  const shutterSound = new Audio("camera-13695.mp3");
  shutterSound.play().catch(err => console.warn("Gagal memutar suara jepret:", err));  
}  
  
// üé• Nyalakan kamera  
async function startCamera() {  
  try {  
    document.getElementById('camera-container').style.display = 'inline-block';  
    stream = await navigator.mediaDevices.getUserMedia({ video: { width: 480, height: 360 }, audio: false });
    video.srcObject = stream;  
    video.style.display = 'block';  
    canvas.style.display = 'none';  
    if (currentFrame !== "") frameOverlay.style.display = 'block';  
    audioEnabled = true;  
    showingPhoto = false;  
  
    // Sembunyikan kontrol video jika sebelumnya muncul  
    videoControlsContainer.style.display = 'none';  
  } catch (err) {  
    alert("Tidak dapat mengakses kamera: " + err);  
  }  
}  
  
// ‚èπ Matikan kamera dengan sempurna  
function stopCamera() {  
  if (stream) {  
    stream.getTracks().forEach(track => track.stop());  
    stream = null;  
  }  
  
  // Matikan tampilan kamera  
  video.srcObject = null;  
  video.src = "";  
  video.pause();  
  video.style.display = 'none';  
  
  // Sembunyikan semua elemen kamera  
  canvas.style.display = 'none';  
  frameOverlay.style.display = 'none';  
  videoControlsContainer.style.display = 'none';  
  videoTimerEl.style.display = 'none';  
  stopVideoTimer();  
  
  // Tampilkan kembali galeri hasil  
  gallery.style.display = 'flex';  
  
  // Sembunyikan tombol kontrol video  
  startRecBtn.style.display = 'none';  
  pauseRecBtn.style.display = 'none';  
  stopRecBtn.style.display = 'none';  
  if (typeof resumeRecBtn !== 'undefined')  
    resumeRecBtn.style.display = 'none';  
  
  console.log("üî¥ Kamera dimatikan sepenuhnya.");  
}  
  
// üì∏ Ambil foto                                                                                 capture
function capturePhoto() {
    const ctx = canvas.getContext('2d');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;

    ctx.save();

    // Terapkan filter sebelum menggambar video agar hasil foto ikut filter
    ctx.filter = filterSelect.value || "none";

    // Balik kamera (mirror)
    ctx.scale(-1, 1);
    ctx.drawImage(video, -canvas.width, 0, canvas.width, canvas.height);

    ctx.restore();

    // Suara jepretan
    playShutter();

    const finalizeCapture = (imageData) => {
        // ‚úÖ Set data foto dan flag siap simpan
        lastCapturedData = imageData;
        fotoSiap = true;
        
        console.log("üì∏ Foto diambil, data tersimpan:", !!lastCapturedData);
        console.log("üìè Ukuran data:", lastCapturedData.length);

        addToGallery(imageData);

        canvas.style.display = 'block';

        if (currentFrame !== "") {
            frameOverlay.style.display = 'block';
        } else {
            frameOverlay.style.display = 'none';
        }

        canvas.classList.add('float-shrink-hold');

        canvas.addEventListener('animationend', function handler() {
            canvas.classList.remove('float-shrink-hold');
            canvas.style.display = 'none';
            canvas.removeEventListener('animationend', handler);
        });
    };

    if (currentFrame !== "") {
        // Jika frame aktif, gabungkan frame ke foto
        const frame = new Image();
        frame.src = currentFrame;
        frame.onload = function() {
            ctx.drawImage(frame, 0, 0, canvas.width, canvas.height);
            const imageData = canvas.toDataURL("image/png");
            console.log("üñº Foto dengan frame disimpan:", !!imageData);
            finalizeCapture(imageData);
        };
    } else {
        // Tanpa frame tetap finalize
        const imageData = canvas.toDataURL("image/png");
        console.log("üñº Foto tanpa frame disimpan:", !!imageData);
        finalizeCapture(imageData);
    }
}

// üñº Tampilkan hasil foto/video di layar kamera  
function showOnCamera(index) {
  currentIndex = index;
  showingPhoto = true;

  // sembunyikan video saat menampilkan foto
  if (stream) video.style.display = 'none';

  const item = galleryImages[index];
  const ctx = canvas.getContext('2d');
  const img = new Image();
  img.src = item.data;

  img.onload = function() {
    canvas.width = video.videoWidth || 480;
    canvas.height = video.videoHeight || 360;
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Flip horizontal agar efek cermin sama seperti saat pengambilan foto
    ctx.save();
    ctx.scale(-1, 1);
    ctx.drawImage(img, -canvas.width, 0, canvas.width, canvas.height);
    ctx.restore();

    // tampilkan frame yang tersimpan di foto tersebut
    if (item.frame) {
      const frameImg = new Image();
      frameImg.src = item.frame;
      frameImg.onload = () => {
        ctx.drawImage(frameImg, 0, 0, canvas.width, canvas.height);
      };
    }

    canvas.style.display = 'block';
    frameOverlay.style.display = 'none'; // jangan tampilkan frame global
  };

 // updateNavigationButtons();
}
  
function showVideoOnCamera(url, isPreview = false) {  
  video.pause();  
  video.srcObject = null;      
  video.src = url;  
  video.controls = true;  
  video.autoplay = true;  
  video.muted = false;  
  video.loop = false;  
  video.style.display = 'block';  
  canvas.style.display = 'none';  
  frameOverlay.style.display = 'none';  

  // ‚úÖ Gunakan pembungkus agar hanya tampilan video yang mirror, bukan kontrolnya
  let videoWrapper = document.getElementById('videoWrapper');
  if (!videoWrapper) {
    // Buat pembungkus secara otomatis kalau belum ada
    videoWrapper = document.createElement('div');
    videoWrapper.id = 'videoWrapper';
    video.parentNode.insertBefore(videoWrapper, video);
    videoWrapper.appendChild(video);
    videoWrapper.style.position = "relative";
    videoWrapper.style.display = "inline-block";
    videoWrapper.style.transformOrigin = "center";
  }

  // Reset transformasi agar aman
  video.style.transform = "scaleX(1)";
  videoWrapper.style.transform = "none";

  if (isPreview) {
    // ‚úÖ Video hasil rekaman: tampil NORMAL (tidak mirror) tapi kontrol tetap benar
    videoWrapper.style.transform = "scaleX(-1)";
  } else {
    // üé• Live camera atau saat rekam video: tetap mirroring
    videoWrapper.style.transform = "scaleX(-1)";
  }

  if (isPreview) {  
    videoControlsContainer.style.display = 'none';  
    stopVideoTimer();  
  } else {  
    videoControlsContainer.style.display = 'flex';  
    startVideoTimer();  
  }  
}

function showNext(event) {  
  event.stopPropagation();  
  if (currentIndex < galleryImages.length - 1) {  
    currentIndex++;  
    showOnCamera(currentIndex);  
  }  
}  
  
// üîπ Tombol kontrol video di dalam kamera  
videoBtn.onclick = async () => {  
  if (!stream) {  
    showCameraAlert("üé• Nyalakan kamera terlebih dahulu!");  
    return;  
  }  
  
  // 1Ô∏è‚É£ Pastikan kamera aktif kembali  
  await startCamera();  
  
canvas.style.display = 'none';
// frameOverlay.style.display = 'none';
video.controls = false;
showingPhoto = false;

// Jangan sembunyikan frame jika ada yang dipilih
if(currentFrame !== "") {
  frameOverlay.style.display = 'block';
} else {
  frameOverlay.style.display = 'none';
}
  // 3Ô∏è‚É£ Tampilkan kontrol untuk perekaman video baru  
  videoControlsContainer.style.display = 'flex';  
  startRecBtn.style.display = 'inline-block';  
  stopRecBtn.style.display = 'none';  
  pauseRecBtn.style.display = 'none';  
  
  // 4Ô∏è‚É£ Sembunyikan timer video sampai mulai rekam  
  stopVideoTimer();  
};  

startRecBtn.onclick = async () => {
  if (!stream) return;

  recordedChunks = [];

  // Ambil audio dari mikrofon
  let audioStream = null;
  try {
    audioStream = await navigator.mediaDevices.getUserMedia({ audio: true });
  } catch (err) {
    console.warn("Tidak dapat mengakses mikrofon: ", err);
  }

  const recordingCanvas = document.createElement('canvas');
  recordingCanvas.width = video.videoWidth;
  recordingCanvas.height = video.videoHeight;
  const rctx = recordingCanvas.getContext('2d');

  // üîπ Tambahan baru: ambil filter yang sedang dipilih
  const filterValue = filterSelect.value || "none";

  // üîπ Variabel untuk tracking frame yang sedang dipakai
  let frameImage = null;
  let lastFrameSrc = "";

  const drawFrame = () => {
    if (!stream) return;
    rctx.clearRect(0, 0, recordingCanvas.width, recordingCanvas.height);

    // Terapkan filter ke setiap frame video
    rctx.filter = filterValue;

    // Gambar video
    rctx.drawImage(video, 0, 0, recordingCanvas.width, recordingCanvas.height);

    // üîπ Update frame overlay jika dipakai
    if (currentFrame && currentFrame !== lastFrameSrc) {
      frameImage = new Image();
      frameImage.src = currentFrame;
      lastFrameSrc = currentFrame;
      frameImage.onload = () => {
        rctx.drawImage(frameImage, 0, 0, recordingCanvas.width, recordingCanvas.height);
      };
    } else if (frameImage) {
      // Gambar frameImage yang sudah ada
      rctx.drawImage(frameImage, 0, 0, recordingCanvas.width, recordingCanvas.height);
    }

    requestAnimationFrame(drawFrame);
  };
  drawFrame();

  // üîπ Ambil video dari canvas (sudah termasuk filter)
  const canvasStream = recordingCanvas.captureStream(30);
  const combinedStream = audioStream
    ? new MediaStream([...canvasStream.getVideoTracks(), ...audioStream.getAudioTracks()])
    : canvasStream;

  // üîπ Rekam hasil stream berfilter
  mediaRecorder = new MediaRecorder(combinedStream);
  mediaRecorder.ondataavailable = e => {
    if (e.data.size > 0) recordedChunks.push(e.data);
  };

  mediaRecorder.onstop = () => {
    const blob = new Blob(recordedChunks, { type: "video/webm" });
    const url = URL.createObjectURL(blob);
    addVideoToGallery(url);
    stopVideoTimer();
  };

  mediaRecorder.start();

  startRecBtn.style.display = 'none';
  pauseRecBtn.style.display = 'inline-block';
  stopRecBtn.style.display = 'inline-block';
  startVideoTimer();
};

pauseRecBtn.onclick = () => {  
  if (!mediaRecorder) return;  
  if (mediaRecorder.state === 'recording') {  
    mediaRecorder.pause();  
    pauseVideoTimer(); // hentikan timer saat pause  
    pauseRecBtn.style.display = 'none';  
    resumeRecBtn.style.display = 'inline-block'; // munculkan tombol resume  
  }  
};  
  
resumeRecBtn.onclick = () => {  
  if (!mediaRecorder) return;  
  if (mediaRecorder.state === 'paused') {  
    mediaRecorder.resume();  
    resumeRecBtn.style.display = 'none';  
    pauseRecBtn.style.display = 'inline-block'; // tampilkan pause lagi  
    resumeVideoTimer(); // lanjutkan timer saat resume
  }  
};
stopRecBtn.onclick = () => {  
  if (!mediaRecorder) return;  
  mediaRecorder.stop();  
  mediaRecorder.onstop = () => {  
    const blob = new Blob(recordedChunks, { type: "video/webm" });  
    const url = URL.createObjectURL(blob);  
    addVideoToGallery(url);  
    stopVideoTimer(); // hentikan timer saat stop  
  };  
  
  // Setelah stop, tampilkan hanya tombol start lagi  
  startRecBtn.style.display = 'inline-block';  
  stopRecBtn.style.display = 'none';  
  pauseRecBtn.style.display = 'none';  
  if (typeof resumeRecBtn !== 'undefined')  
    resumeRecBtn.style.display = 'none';  
  videoControlsContainer.style.display = 'none';  
};  
// üé¨ Tombol kontrol utama  
startBtn.onclick = startCamera;  
stopBtn.onclick = stopCamera;  

captureBtn.onclick = () => {
  if (!stream) {
    showCameraAlert(); // tampilkan pop-up jika kamera belum aktif
    return;
  }

  // Jika sedang menampilkan hasil foto di layar kamera
  if (showingPhoto) {
    // üëâ Tekan pertama: kembali ke mode kamera, tidak mengambil foto
    showingPhoto = false;
    isPreviewActive = false;
    startCamera(); // aktifkan kembali mode kamera
    return;
  }

  // üëâ Tekan kedua atau normal: ambil foto seperti biasa
  handleCapture();
};


deleteBtn.onclick = () => {  
  if (galleryImages.length === 0) { 
    alert("Belum ada foto/video yang bisa dihapus!"); 
    return; 
  }  

  const deletedItem = galleryImages.splice(currentIndex, 1)[0]; // hapus item

  // Hapus thumbnail dari galeri
  if (gallery.children[currentIndex]) gallery.removeChild(gallery.children[currentIndex]);  

  // Tentukan index berikutnya yang akan ditampilkan
  if (currentIndex >= galleryImages.length) currentIndex = galleryImages.length - 1;  

  if (currentIndex >= 0) {
    const nextItem = galleryImages[currentIndex];
    if (nextItem.type === 'photo') {
      showOnCamera(currentIndex);
    } else if (nextItem.type === 'video') {
      showVideoOnCamera(nextItem.data, true);
    }
  } else {
    // Tidak ada item tersisa, kembalikan ke mode kamera
    startCamera();
  }
};
  
filterSelect.addEventListener("change", () => {  
  video.style.filter = filterSelect.value;  
});  
  
function handleCapture() {  
  if (!stream) {  
    alert("‚ö† Nyalakan kamera terlebih dahulu!");  
    return;  
  }  
  
  const seconds = parseInt(timerSelect.value);  
  if (seconds === 0) { capturePhoto(); return; }  
  
  countdownEl.style.display = 'block';  
  let count = seconds;  
  countdownEl.textContent = count;  
  
  const interval = setInterval(() => {  
    playBeep();  
    count--;  
    countdownEl.textContent = count;  
    if (count <= 0) {  
      clearInterval(interval);  
      countdownEl.style.display = 'none';  
      capturePhoto();  
    }  
  }, 1000);  
}  
// === DASHBOARD HANDLER ===                                          yhkkl';l'''''''''''''''''''''''''''''''''''
function showSection(section) {
    console.log("üîÑ Menampilkan section:", section);
    
    // Sembunyikan semua section utama
    const sectionsToHide = ["dashboard", "photobooth-section", "pembayaran-section", "paket-section"];
    sectionsToHide.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
            element.style.display = "none";
            console.log("‚ùå Sembunyikan:", id);
        }
    });
    
    // Tampilkan section yang dipilih
    if (section === "dashboard") {
        document.getElementById("dashboard").style.display = "block";
        console.log("‚úÖ Tampilkan: dashboard");
    } 
    else if (section === "photobooth") {
        // ‚úÖ CEK: Harus sudah pilih paket DAN sudah bayar
        if (!paketDuration) {
            alert("Silakan pilih paket terlebih dahulu di Menu Paket.");
            document.getElementById("dashboard").style.display = "block";
            return;
        }
        if (!pembayaranVerified) {
            alert("Silakan lakukan pembayaran terlebih dahulu di Menu Pembayaran.");
            document.getElementById("dashboard").style.display = "block";
            return;
        }
        document.getElementById("photobooth-section").style.display = "block";
        console.log("‚úÖ Tampilkan: photobooth-section");
        mulaiTimerPaket();
    } 
    else if (section === "pembayaran") {
        // ‚úÖ CEK: Harus sudah pilih paket dulu
        if (!paketDuration) {
            alert("Silakan pilih paket terlebih dahulu di Menu Paket.");
            document.getElementById("dashboard").style.display = "block";
            return;
        }
        document.getElementById("pembayaran-section").style.display = "block";
        console.log("‚úÖ Tampilkan: pembayaran-section");
    } 
    else if (section === "paket") {
        document.getElementById("paket-section").style.display = "block";
        console.log("‚úÖ Tampilkan: paket-section");
    }
    
    // ‚úÖ BARU: Update status dashboard setiap ganti section
    updateDashboardStatus();
    
    // ‚úÖ BARU: Update sidebar state setelah ganti section
    setTimeout(() => {
            updateSidebarState();
    }, 100);
}

function kirimPembayaran() {
    const nama = document.getElementById('nama').value;
    const email = document.getElementById('email').value;
    const nohp = document.getElementById('nohp').value;
    const metode = document.getElementById('metode').value;

    if (!nama || !email || !nohp || !metode) {
        alert("‚ö† Mohon lengkapi semua data sebelum mengirim pembayaran!");
        return;
    }

    // ‚úÖ VERIFIKASI PEMBAYARAN BERHASIL
    paketActive = true;
    pembayaranVerified = true;
    waktuSisa = paketDuration; // Set waktu sesuai paket yang dipilih

    const hasilDiv = document.getElementById('hasilPembayaran');
    hasilDiv.style.display = 'block';
    hasilDiv.innerHTML = `
        <h3>‚úÖ Pembayaran Berhasil Diverifikasi!</h3>
        <p><strong>Nama:</strong> ${nama}</p>
        <p><strong>Email:</strong> ${email}</p>
        <p><strong>No. HP:</strong> ${nohp}</p>
        <p><strong>Metode:</strong> ${metode}</p>
        <p><strong>Status:</strong> ‚úÖ AKTIF - Silakan masuk ke Photo Booth</p>
    `;

    document.getElementById('formPembayaran').reset();
    
    // ‚úÖ KEMBALI KE DASHBOARD setelah 3 detik
    setTimeout(() => {
        showSection("dashboard");
        updateDashboardStatus();
    }, 1000);
    
    console.log("‚úÖ Pembayaran verified, photobooth sekarang AKTIF");
}

function pilihPaket(namaPaket) {
    // Set durasi paket
    if (namaPaket === "Basic") paketDuration = 60 * 60; 
    if (namaPaket === "Premium") paketDuration = 2 * 60 * 60;
    if (namaPaket === "VIP") paketDuration = 3 * 60 * 60;
    
    // Tandai paket dipilih, TAPI pembayaran belum
    paketActive = false;
    pembayaranVerified = false;
    
    // Reset gallery
    galleryImages = [];
    gallery.innerHTML = "";
    currentIndex = 0;
    
    alert("Anda memilih Paket " + namaPaket + "\nSilahkan lanjutkan ke Menu Pembayaran untuk melakukan pembayaran.");
    
    // ‚úÖ KEMBALI KE DASHBOARD, bukan ke pembayaran
    showSection("dashboard");
    updateDashboardStatus(); // Update status di dashboard
}

function mulaiTimerPaket() {
  const displayTimer = document.getElementById("paketTimerDisplay");

  clearInterval(paketTimer);

  paketTimer = setInterval(() => {
    waktuSisa--;

    displayTimer.style.display = "block";
    displayTimer.innerText = "Sisa waktu: " + formatTime(waktuSisa);

    if (waktuSisa <= 0) {
      clearInterval(paketTimer);
      paketActive = false;
      displayTimer.innerText = "Waktu paket habis";

      alert("Waktu paket Anda sudah habis.");

      // Matikan kamera
      stopCamera();
      document.getElementById("captureBtn").disabled = true;
    }
  }, 1000);
}

function formatTime(sec) {
  let m = Math.floor(sec / 60);
  let s = sec % 60;
  return `${m}:${s.toString().padStart(2, '0')}`;
}

function updateDashboardStatus() {
    const statusDiv = document.getElementById('statusPembayaran');
    if (!statusDiv) return;

    if (pembayaranVerified) {
        // ‚úÖ SUDAH BAYAR - BISA MASUK PHOTOBOOTH
        statusDiv.innerHTML = `
            <div style="background:rgba(0,255,0,0.1); border:2px solid #00ff00; padding:15px; border-radius:10px;">
                <h3>‚úÖ PAKET AKTIF</h3>
                <p>Pembayaran telah diverifikasi. Anda dapat menggunakan Photo Booth.</p>
                <p><strong>Sisa waktu: <span id="statusTimer">${formatTime(waktuSisa)}</span></strong></p>
            </div>
        `;
        statusDiv.style.display = 'block';
    } 
    else if (paketDuration) {
        // ‚úÖ SUDAH PILIH PAKET TAPI BELUM BAYAR
        statusDiv.innerHTML = `
            <div style="background:rgba(255,255,0,0.1); border:2px solid #ffff00; padding:15px; border-radius:10px;">
                <h3>‚ö† MENUNGGU PEMBAYARAN</h3>
                <p>Anda sudah memilih paket. Silakan lakukan pembayaran untuk mengaktifkan Photo Booth.</p>
            </div>
        `;
        statusDiv.style.display = 'block';
    }
    else {
        // ‚ùå BELUM PILIH PAKET
        statusDiv.style.display = 'none';
    }
}

if (downloadBtn) {
    downloadBtn.addEventListener('click', downloadHasil);
}
if (printBtn) {
    printBtn.addEventListener('click', cetakFoto);
}

// ‚úÖ FUNGSI DOWNLOAD HASIL (Foto & Video)
function downloadHasil() {
    if (galleryImages.length === 0) {
        alert("‚ö† Belum ada foto atau video yang bisa didownload!");
        return;
    }

    // Jika sedang menampilkan preview di kamera
    if (showingPhoto && galleryImages[currentIndex]) {
        const currentItem = galleryImages[currentIndex];
        downloadItem(currentItem);
    } else {
        // Jika tidak ada preview, download yang terakhir
        const lastItem = galleryImages[galleryImages.length - 1];
        downloadItem(lastItem);
    }
}

function downloadItem(item) {
    if (item.type === 'photo') {
        downloadFoto(item.data);
    } else if (item.type === 'video') {
        downloadVideo(item.data);
    }
}

function downloadFoto(dataURL) {
    const link = document.createElement('a');
    link.download = ` photo-booth-${new Date().getTime()}.png`;
    link.href = dataURL;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    // Efek feedback
    showFeedback("‚úÖ Foto berhasil didownload!");
}

function downloadVideo(videoURL) {
    const link = document.createElement('a');
    link.download =   `photo-booth-video-${new Date().getTime()}.webm`;
    link.href = videoURL;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    // Efek feedback
    showFeedback("‚úÖ Video berhasil didownload!");
}

// ‚úÖ FUNGSI CETAK FOTO (Hanya Foto, bukan Video)
function cetakFoto() {
    if (galleryImages.length === 0) {
        alert("‚ö† Belum ada foto yang bisa dicetak!");
        return;
    }

    // Cari foto terakhir atau yang sedang dipreview
    let fotoToPrint = null;
    
    if (showingPhoto && galleryImages[currentIndex] && galleryImages[currentIndex].type === 'photo') {
        fotoToPrint = galleryImages[currentIndex].data;
    } else {
        // Cari foto terakhir dari gallery
        for (let i = galleryImages.length - 1; i >= 0; i--) {
            if (galleryImages[i].type === 'photo') {
                fotoToPrint = galleryImages[i].data;
                break;
            }
        }
    }

    if (!fotoToPrint) {
        alert("‚ö† Tidak ada foto yang bisa dicetak. Silakan ambil foto terlebih dahulu.");
        return;
    }

    printFoto(fotoToPrint);
}

function printFoto(dataURL) {
    // Jika semua method gagal, arahkan user untuk download lalu print manual
    const link = document.createElement('a');
    link.download = `photo-booth-${Date.now()}.png`;
    link.href = dataURL;
    link.click();
    
    showFeedback("üì• Foto didownload - silakan print manual dari file");
    
    // Optional: Tampilkan instruksi
    setTimeout(() => {
        if (confirm("Foto telah didownload. Buka dialog print untuk file yang didownload?")) {
            // Bisa tambahkan instruksi di sini
        }
    }, 1000);
}

// ‚úÖ FUNGSI FEEDBACK UNTUK USER
function showFeedback(message) {
    // Hapus feedback sebelumnya jika ada
    const existingFeedback = document.getElementById('feedbackMessage');
    if (existingFeedback) {
        existingFeedback.remove();
    }

    // Buat elemen feedback baru
    const feedback = document.createElement('div');
    feedback.id = 'feedbackMessage';
    feedback.textContent = message;
    feedback.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: rgba(0, 255, 0, 0.9);
        color: white;
        padding: 15px 20px;
        border-radius: 10px;
        font-weight: bold;
        z-index: 10000;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        animation: fadeInOut 3s ease-in-out;
    `;

    document.body.appendChild(feedback);

    // Hapus otomatis setelah 3 detik
    setTimeout(() => {
        if (feedback.parentNode) {
            feedback.parentNode.removeChild(feedback);
        }
    }, 3000);
}

// ‚úÖ TAMBAH CSS ANIMASI UNTUK FEEDBACK
const style = document.createElement('style');
style.textContent = `
    @keyframes fadeInOut {
        0% { opacity: 0; transform: translateY(-20px); }
        10% { opacity: 1; transform: translateY(0); }
        90% { opacity: 1; transform: translateY(0); }
        100% { opacity: 0; transform: translateY(-20px); }
    }
`;
document.head.appendChild(style);

    if (menuHome) {
        menuHome.addEventListener('click', function(event) {
            handleHomeClick(event);
            if (getCurrentSection() !== 'dashboard') {
                closeSidebar();
            }
        });
    }
function handleHomeClick(event) {
    // Single click - langsung kembali ke dashboard
    showSection('dashboard');
    
    // Double click detection
    if (homeClickTimer) {
        // Double click detected
        clearTimeout(homeClickTimer);
        homeClickTimer = null;
        handleDoubleClick();
    } else {
        // Single click - tunggu sebentar untuk cek double click
        homeClickTimer = setTimeout(() => {
            homeClickTimer = null;
            // Single click action sudah dilakukan di atas (showSection)
        }, 300);
    }
}
function handleDoubleClick() {
    console.log("üîÑ Double click detected - refreshing...");
    
    // Feedback visual
    menuHome.classList.add('home-double-click');
    setTimeout(() => {
        menuHome.classList.remove('home-double-click');
    }, 600);
    
    // Tampilkan konfirmasi
    if (confirm("Apakah Anda yakin ingin merefresh halaman? Semua progress akan direset.")) {
        // Reset semua state
        resetAppState();
        
        // Feedback sebelum refresh
        showFeedback("üîÑ Merefresh halaman...");
        
        // Refresh halaman setelah delay kecil
        setTimeout(() => {
            location.reload();
        }, 1000);
    }
}
function resetAppState() {
    // Reset semua variable state
    paketActive = false;
    pembayaranVerified = false;
    paketDuration = 0;
    waktuSisa = 0;
    
    // Hentikan semua timer
    if (paketTimer) clearInterval(paketTimer);
    if (videoTimerInterval) clearInterval(videoTimerInterval);
    
    // Matikan kamera jika aktif
    if (stream) {
        stopCamera();
    }
    
    // Reset gallery
    galleryImages = [];
    gallery.innerHTML = "";
    currentIndex = 0;
    
    console.log("üîÑ State aplikasi direset");
}


// ===== EVENT LISTENERS TERPUSAT =====
document.addEventListener('DOMContentLoaded', function() {
    console.log("üöÄ Aplikasi Photo Booth dimuat");
    
    // Inisialisasi sidebar
    initSidebar();
    
    // Camera controls
    startBtn.onclick = startCamera;
    stopBtn.onclick = stopCamera;
    captureBtn.onclick = () => {
        if (!stream) {
            showCameraAlert();
            return;
        }
        if (showingPhoto) {
            showingPhoto = false;
            isPreviewActive = false;
            startCamera();
            return;
        }
        handleCapture();
    };
    
    videoBtn.onclick = async () => {  
        if (!stream) {  
            showCameraAlert("üé• Nyalakan kamera terlebih dahulu!");  
            return;  
        }  
        await startCamera();  
        canvas.style.display = 'none';
        video.controls = false;
        showingPhoto = false;
        if(currentFrame !== "") {
            frameOverlay.style.display = 'block';
        } else {
            frameOverlay.style.display = 'none';
        }
        videoControlsContainer.style.display = 'flex';  
        startRecBtn.style.display = 'inline-block';  
        stopRecBtn.style.display = 'none';  
        pauseRecBtn.style.display = 'none';  
        stopVideoTimer();  
    };
    
    deleteBtn.onclick = () => {  
        if (galleryImages.length === 0) { 
            alert("Belum ada foto/video yang bisa dihapus!"); 
            return; 
        }  
        const deletedItem = galleryImages.splice(currentIndex, 1)[0];
        if (gallery.children[currentIndex]) gallery.removeChild(gallery.children[currentIndex]);  
        if (currentIndex >= galleryImages.length) currentIndex = galleryImages.length - 1;  
        if (currentIndex >= 0) {
            const nextItem = galleryImages[currentIndex];
            if (nextItem.type === 'photo') {
                showOnCamera(currentIndex);
            } else if (nextItem.type === 'video') {
                showVideoOnCamera(nextItem.data, true);
            }
        } else {
            startCamera();
        }
    };
    
    // Video recording controls
    startRecBtn.onclick = startRecording;
    pauseRecBtn.onclick = pauseRecording;
    resumeRecBtn.onclick = resumeRecording;
    stopRecBtn.onclick = stopRecording;
    
    // Filter & Frame
    filterSelect.addEventListener("change", () => {
        video.style.filter = filterSelect.value;
    });
    
    frameSelect.addEventListener('change', () => {
        const selectedFrame = frameSelect.value;
        if (!selectedFrame) {
            frameOverlay.style.display = 'none';
            currentFrame = "";
        } else {
            currentFrame = selectedFrame;
            frameOverlay.src = selectedFrame;
            frameOverlay.style.display = 'block';
        }
    });
    
    // Menu Sidebar
    
    if (menuGuide) {
        menuGuide.addEventListener('click', function() {
            alert("üìñ Petunjuk Penggunaan akan segera tersedia!");
            closeSidebar();
        });
    }
    
    if (menuAbout) {
        menuAbout.addEventListener('click', function() {
            alert("‚Ñπ Tentang Kami - Photo Booth App v1.0");
            closeSidebar();
        });
    }
    
    // Download & Print
    if (downloadBtn) {
        downloadBtn.addEventListener('click', downloadHasil);
    }
    if (printBtn) {
        printBtn.addEventListener('click', cetakFoto);
    }
    
    // ‚úÖ PASTIKAN STATE AWAL SIDEBAR BENAR
    setTimeout(() => {
        updateSidebarState();
    }, 500);
});

</script>  
</body>  
</html>